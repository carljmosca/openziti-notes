version: '3.8'

services:
  ziti-controller:
    image: docker.io/openziti/ziti-controller:latest
    container_name: ziti-controller
    user: "0:0"
    env_file: .env
    ports:
      - "1280:1280" # Keep internal for now; we will hide this later
      - "6262:6262"
    volumes:
      - ./controller-data:/persistent:Z
    networks:
      - ziti-net

  ziti-router:
    image: docker.io/openziti/ziti-router:latest
    container_name: ziti-router
    env_file: .env
    environment:
      - ZITI_BOOTSTRAP=true
      - ZITI_ROUTER_NAME=ziti-router
    ports:
      - "10080:10080"
    volumes:
      - ./router-data:/persistent:Z
    networks:
      - ziti-net

  caddy:
    image: docker.io/carljmosca/ziti-caddy:latest
    container_name: caddy
    restart: unless-stopped
    # ... keep your volumes and networks as they were
    volumes:
      - ./Caddyfile:/etc/caddy/Caddyfile:Z
      - ./caddy-data:/data:Z
      - ./caddy-config:/config:Z
      - ./caddy-identity.json:/etc/caddy/caddy-identity.json:Z

networks:
  ziti-net:
    driver: bridge